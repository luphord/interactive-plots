<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Interactive Plots</title>
    <link rel="stylesheet" href="assets/vendor/chartist.min.css">
    <link rel="stylesheet" href="assets/vendor/water.min.css">
  </head>
  <body>
    <h1>Interactive Plots</h1>
    <div id="container">
    </div>
    <script src="assets/vendor/chartist.min.js"></script>
    <script>

const InteractivePlot = function(container) {
  this.container = container;
  this.sliders = [];
  this.charts = [];
  this.vars = {};
}

InteractivePlot.prototype.createSlider = function(name, min, max, value) {
  const slider = document.createElement("input");
  slider.type = "range";
  slider.min = min;
  slider.max = max;
  slider.value = value;
  const that = this;
  slider.oninput = function() {
    that.vars[name] = this.value;
    that.redraw();
  };
  this.vars[name] = slider.value;
  this.container.appendChild(slider);
  this.sliders.push(slider);
  return slider;
};

InteractivePlot.prototype.createLineChart = function(options, updateFunction) {
  const div = document.createElement("div");
  div.classList.add(".ct-chart");
  div.classList.add("ct-perfect-fourth");
  this.container.appendChild(div);
  const chart = new Chartist.Line(div, {}, options);
  this.charts.push({"chart": chart, "updateFunction": updateFunction});
  return chart;
};

InteractivePlot.prototype.redraw = function() {
  for (let i=0; i<this.charts.length; i++) {
    this.charts[i].updateFunction(this.charts[i].chart, this.vars);
  }
};

// define sliders and charts

var data = {
  series: [
    [5, 5, 7, 1, 6, 0],
    [0, 1, 2, 3, 4, 5],
    [-2, 4, 3, 2, 5, 1]
  ]
};

var options = {
  showPoint: false,
  lineSmooth: true,
  axisX: {
    showGrid: false,
    showLabel: false
  },
  axisY: {
    offset: 80,
    labelInterpolationFnc: function(value) {
      return value.toFixed(2);
    }
  }
};

var plt = new InteractivePlot(document.getElementById("container"));

plt.createLineChart(options, function(chart, vars) {
  data.series[0][0] = vars.first;
  data.series[0][1] = vars.second;
  chart.update(data);
});

plt.createSlider("first", 1, 20, 5);
plt.createSlider("second", 1, 20, 5);

plt.redraw();

/*// Updates to/from hash
var counter = 0

slider.onchange = () => history.pushState(null, null, "#" + ++counter);

slider2.onchange = () => history.pushState(null, null, "#" + ++counter);

window.onhashchange = evt => console.log(evt);*/
    </script>
  </body>
</html>